/* Version 1.0 by (c) 2016, JDMCreator. Released under MIT License */
(function(){var r=function(a){return a.replace(/^[\s\uFEFF\xA0~]+|[\s\uFEFF\xA0~]+$/g,"")};isALetter=function(a){a=a.charAt(0);return a.toUpperCase()!==a.toLowerCase()};execBlocks=function(a,b){return a.replace(/\{([_^]?[0-9]+)\}/g,function(a,d){return b[d]})};isLowerCaseAt=function(a,b){var c=a.charAt(b);return isALetter(c)?c===c.toLowerCase():"{"==c&&(c=a.charAt(b+1))?"_"==c:!1};isUpperCaseAt=function(a,b){var c=a.charAt(b);return isALetter(c)?c===c.toUpperCase():"{"==c&&(c=a.charAt(b+1))?"^"==
c:!1};parseBibtexNames=function(a){var b={},c=0;if(0<=a.indexOf("{")||0<=a.indexOf("\\"))for(var d="",f="",k="",p=0,l=!1,g=!1,m=!1,q=!1,e=0,n=a.length,h;e<n;e++)if(h=a.charAt(e),!q&&"\\"==h)d+=""+h+a.charAt(e+1),e++;else if(!q&&"{"!=h)d+=""+h;else if(!q&&"{"==h)q=!0,k+=h,"\\"==a.charAt(e+1)&&(l=!0);else if(q){if(l&&!m&&g&&isALetter(h)){var f="^",m=h,t=m.toUpperCase();t!==m&&t!==m.toLowerCase()&&(f="_");m=!0}else l&&!g&&/^[\{\s]$/.test(h)&&(g=!0);if("\\"==h)if(t=a.charAt(e+1),!t||"{"!=t&&"\\"!=t&&
"}"!=t)g&&!m&&(g=!1);else{k+=h+t;e++;continue}"{"==h?(p++,k+=h):"}"==h?0>=p||e+1<n.length?(q=!1,k+=h,f+=c++,d+="{"+f+"}",b[f]=k,k=f="",l=g=m=!1):(p--,k+=h):(f||l||isALetter(h)&&(f="^"),k+=h)}a=(d||a).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"").split(/(?:\s+and\s+)(?=.)/ig);c=[];for(e=0;e<a.length;e++)c.push(analyseName(a[e],b));return c};analyseName=function(a,b){var c=a.split(/\s*,\s*/g),d=c.length-1,f=analyseFirstBlock(r(c[0]),d,b);1==d&&(f.first=execBlocks(r(c[1]),b));2==d&&(f.jr=execBlocks(r(c[1]),
b),f.first=execBlocks(r(c[2]),b));return f};analyseFirstBlock=function(a,b,c){var d={},f=0<b,k=/[\~\s]+/g,p="",l="",g=a,m=!0,q="";if(!k.test(a))return"others"==a&&0==b?{special:a}:{last:execBlocks(a,c)};b=0;for(var e=a.length,n;b<e&&(n=a.charAt(b),!f);b++)if(k.test(n))m=!0,l+=n;else if(m&&(isALetter(n)||"{"==n))if(isLowerCaseAt(a,b)){f=!0;p&&(d.first=execBlocks(p,c),g=r(a.substring((p+l).length)));break}else isUpperCaseAt(a,b)&&(m=!1,p+=l+q+""+n,q=l="");else m?q+=""+n:p+=""+n;if(f)if(k.test(g))for(e=
a="",m=!0,l="",g=" "+g,b=g.length-1;-1<b;b--)if(n=g.charAt(b),k.test(n))if(e){m=!0;for(f=b+1;f<g.length;f++)if(p=g.charAt(f),isALetter(p)||"{"==p)if(isLowerCaseAt(g,f)){m=!1;break}else{if(isUpperCaseAt(g,f))break}else if(k.test(p))break;if(m)a=e+l+a,l=n,e="";else{d.last=execBlocks(r(a),c);g=g.substring(0,g.length-(l+a).length);d.von=execBlocks(r(g),c);break}}else l=n+l;else e=n+""+e;else return d.last=execBlocks(g,c),d;else{var k=a.split(/[\s~]+/g),h=[],l="";a.replace(/[\s~]+/g,function(a){h.push(a)});
d.last=execBlocks(k[k.length-1],c);k.pop();b=0;for(e=k.length;b<e;b++)l+=""+k[b],b+1<e&&(l+=h[b]);d.first=execBlocks(l,c)}d.hasOwnProperty("last")||(d.hasOwnProperty("von")?(d.last=d.von,delete d.von):d.last=execBlocks(r(g),c));return d};window.parseBibtexNames=parseBibtexNames})();